# =============================================================================
# Packet Inspection Transformer - Development Docker Compose
# =============================================================================
# Development configuration with hot-reload and debugging support
# =============================================================================

services:
  # -----------------------------------------------------------------------------
  # Frontend Development Service
  # -----------------------------------------------------------------------------
  frontend:
    build:
      context: ./Frontend
      dockerfile: Dockerfile.dev
    container_name: pit-frontend-dev
    restart: unless-stopped
    ports:
      - "5173:5173"
    volumes:
      - ./Frontend/src:/app/src:ro
      - ./Frontend/public:/app/public:ro
    environment:
      - VITE_API_URL=http://localhost:8000
      - NODE_ENV=development
    stdin_open: true
    tty: true
    networks:
      - pit-network-dev

  # -----------------------------------------------------------------------------
  # Backend Development Service
  # -----------------------------------------------------------------------------
  backend:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: pit-backend-dev
    restart: unless-stopped
    ports:
      - "8000:8000"
      - "5678:5678"  # Debug port for VSCode
    volumes:
      # Mount source code for hot-reload
      - .:/app:ro
      # Exclude node_modules
      - /app/Frontend/node_modules
      - /app/node_modules
    environment:
      - ENVIRONMENT=development
      - DEBUG=true
      - LOG_LEVEL=debug
      - HOST=0.0.0.0
      - PORT=8000
      - RELOAD=true
    command: >
      python -m uvicorn app:app
      --host 0.0.0.0
      --port 8000
      --reload
      --reload-dir /app
      --log-level debug
    networks:
      - pit-network-dev
    labels:
      - "com.docker.compose.project=packet-inspection-transformer-dev"

  # -----------------------------------------------------------------------------
  # Optional: Database for development
  # -----------------------------------------------------------------------------
  # redis:
  #   image: redis:7-alpine
  #   container_name: pit-redis-dev
  #   ports:
  #     - "6379:6379"
  #   volumes:
  #     - redis-data:/data
  #   networks:
  #     - pit-network-dev

# -----------------------------------------------------------------------------
# Networks
# -----------------------------------------------------------------------------
networks:
  pit-network-dev:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.29.0.0/16

# -----------------------------------------------------------------------------
# Volumes
# -----------------------------------------------------------------------------
volumes:
  redis-data: